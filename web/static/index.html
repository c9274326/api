<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gthulhu API server Client</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>Gthulhu API server Client</h1>
        <div class="auth-status" id="authStatus">
            <span id="authText">Not Authenticated</span>
            <button id="authBtn" onclick="showAuthModal()">Get Token</button>
        </div>
    </header>

    <main>
        <!-- Authentication Modal -->
        <div id="authModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="hideAuthModal()">&times;</span>
                <h2>Authentication</h2>
                
                <!-- Auth Type Tabs -->
                <div class="auth-tabs">
                    <button class="auth-tab active" onclick="switchAuthTab('password')">Username/Password</button>
                    <button class="auth-tab" onclick="switchAuthTab('publickey')">Public Key</button>
                </div>
                
                <!-- Password Login Form -->
                <form id="passwordAuthForm" class="auth-form active">
                    <label for="username">Email:</label>
                    <input type="email" id="username" placeholder="admin@example.com" required>
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Password" required>
                    <button type="submit">Login</button>
                </form>
                
                <!-- Public Key Form -->
                <form id="publicKeyAuthForm" class="auth-form" style="display:none;">
                    <label for="publicKey">Public Key (PEM format):</label>
                    <textarea id="publicKey" placeholder="-----BEGIN PUBLIC KEY-----
...
-----END PUBLIC KEY-----"></textarea>
                    <button type="button" onclick="fillSampleKey()" style="margin-bottom: 10px;">Fill Sample Key</button>
                    <button type="submit">Get Token</button>
                </form>
                
                <div id="authResult"></div>
            </div>
        </div>

        <!-- API Endpoints -->
        <div class="api-section">
            <h2>Health Check</h2>
            <div class="control-panel">
                <button onclick="checkHealth()" class="api-btn">Check Service Health</button>
                <div class="interval-controls">
                    <label for="healthInterval">Auto-refresh interval (seconds):</label>
                    <input type="number" id="healthInterval" min="1" max="300" value="5">
                    <button onclick="toggleHealthAutoRefresh()" id="healthAutoBtn">Start Auto-refresh</button>
                </div>
            </div>
            <div class="health-status-grid">
                <h4>Health Status (Last 10 checks)</h4>
                <div id="healthGrid" class="status-grid"></div>
                <div class="grid-legend">
                    <span class="legend-item"><span class="status-box healthy"></span> Healthy</span>
                    <span class="legend-item"><span class="status-box unhealthy"></span> Unhealthy</span>
                </div>
            </div>
            <pre id="healthResult" class="result"></pre>
        </div>

        <div class="api-section">
            <h2>Pod-PID Mapping</h2>
            <button onclick="getPodPids()" class="api-btn auth-required">Get Pod-PID Mapping</button>
            <pre id="podPidsResult" class="result"></pre>
        </div>

        <div class="api-section">
            <h2>Scheduling Strategies</h2>
            <button onclick="getStrategies()" class="api-btn auth-required">Get Scheduling Strategies</button>
            <pre id="strategiesResult" class="result"></pre>
            
            <h3>Set New Scheduling Strategies</h3>
            <div class="strategies-manager">
                <div id="strategiesContainer">
                    <!-- Strategy templates will be added here -->
                </div>
                <div class="strategy-controls">
                    <button type="button" onclick="addStrategy()" class="add-strategy-btn">Add Strategy</button>
                    <button type="button" onclick="saveAllStrategies()" class="api-btn auth-required">Save All Strategies</button>
                    <button type="button" onclick="clearAllStrategies()" class="clear-btn">Clear All</button>
                </div>
            </div>
        </div>

        <div class="api-section">
            <h2>Current Metrics</h2>
            <div class="control-panel">
                <button onclick="getMetrics()" class="api-btn auth-required">Get Current Metrics</button>
                <div class="interval-controls">
                    <label for="metricsInterval">Auto-refresh interval (seconds):</label>
                    <input type="number" id="metricsInterval" min="1" max="300" value="10">
                    <button onclick="toggleMetricsAutoRefresh()" id="metricsAutoBtn" class="auth-required">Start Auto-refresh</button>
                </div>
            </div>
            <pre id="metricsResult" class="result"></pre>
            <div class="metrics-info">
                <h3>Metrics Information</h3>
                <ul>
                    <li><strong>Last Run Time:</strong> Timestamp of last scheduler run</li>
                    <li><strong>Queued Tasks:</strong> Number of tasks in queue</li>
                    <li><strong>Scheduled Tasks:</strong> Number of scheduled tasks</li>
                    <li><strong>Running Tasks:</strong> Number of currently running tasks</li>
                    <li><strong>Online CPUs:</strong> Number of available CPU cores</li>
                    <li><strong>User Dispatches:</strong> Number of user-space dispatches</li>
                    <li><strong>Kernel Dispatches:</strong> Number of kernel-space dispatches</li>
                    <li><strong>Cancel Dispatches:</strong> Number of cancelled dispatches</li>
                    <li><strong>Bounce Dispatches:</strong> Number of bounced dispatches</li>
                    <li><strong>Failed Dispatches:</strong> Number of failed dispatches</li>
                    <li><strong>Scheduler Congested:</strong> Number of scheduler congestion events</li>
                </ul>
            </div>
        </div>
    </main>

    <script src="app.js"></script>
</body>
</html>
